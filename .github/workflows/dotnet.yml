name: .NET

# Триггеры: при пуше или пулл реквестов в main.
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # Один job, который собирает и тестирует проект.
  build:

    # Среда выполнения — виртуальная машина Ubuntu.
    runs-on: ubuntu-latest

    steps:
    # Получаем код репозитория (обязательный первый шаг).
    - uses: actions/checkout@v4
    
    # Устанавливаем нужную версию .NET SDK 10.
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x
        
    # Восстанавливаем NuGet‑пакеты перед сборкой.    
    - name: Restore dependencies
      run: dotnet restore
    
    # Компиляция проекта.
    - name: Build
      run: dotnet build --no-restore
  
  # Job для тестирования.
  test:
    runs-on: ubuntu-latest
    
    # Выполнение после build.
    needs: build
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x
          
    - name: Restore dependencies
      run: dotnet restore
    
    # Запуск тестов.
    - name: Test
      run: dotnet test --verbosity normal  